@reference "../global.css";

/* Music Controls */
.music-controls {
  @apply border border-solid;
  backdrop-filter: blur(15px);
  background: rgba(10, 10, 10, 0.8);
  border-color: rgba(255, 0, 150, 0.3);
  border-radius: var(--radius-xl);
  box-shadow: 0 0 30px rgba(255, 0, 150, 0.2),
  0 8px 32px rgba(0, 0, 0, 0.5),
  inset 0 1px 0 rgba(255, 0, 150, 0.1);
  padding: var(--spacing-md);
}

.music-controls.hidden {
  @apply hidden;
}

.music-info {
  @apply flex items-center;
  gap: var(--spacing-xs);
  margin-bottom: var(--spacing-sm);
}

.music-title {
  @apply flex-1 overflow-hidden truncate whitespace-nowrap font-bold tracking-wider;
  color: #ff0096;
  font-family: var(--font-family-base);
  font-size: var(--font-size-xs);
}

.music-info-btn {
  @apply flex items-center justify-center flex-shrink-0 cursor-pointer p-0;
  @apply w-6 h-6 rounded-full border border-solid transition-all duration-300;
  anchor-name: --music-info-btn;
  background: rgba(255, 0, 150, 0.1);
  border-color: #ff0096;
  color: #ff0096;
}

.music-info-btn:hover {
  @apply scale-110;
  background: rgba(255, 0, 150, 0.2);
  box-shadow: 0 0 15px rgba(255, 0, 150, 0.5);
}

.music-tooltip {
  /* Anchor positioning with automatic fallbacks for viewport overflow
     Works in Chromium 125+, Firefox 128+
     JavaScript fallback provided for older browsers
     Polyfill available: https://github.com/oddbird/css-anchor-positioning */
  @apply fixed m-0 mt-2 overflow-y-auto border-2 border-solid text-white font-semibold leading-relaxed -translate-x-1/2 transition-all duration-200;
  backdrop-filter: blur(10px);
  background: rgba(0, 0, 0, 0.98);
  border-color: #ff0096;
  border-radius: var(--radius-lg);
  box-shadow: 0 0 30px rgba(255, 0, 150, 0.6);
  font-size: var(--font-size-sm);
  inset: auto;
  left: anchor(center);
  max-height: 300px;
  max-width: min(400px, calc(100vw - 20px));
  min-width: min(280px, calc(100vw - 20px));
  padding: var(--spacing-md);
  position-anchor: --music-info-btn;
  position-try-fallbacks: --tooltip-left, --tooltip-right, --tooltip-above;
  top: anchor(bottom);
  transition: opacity 0.2s, transform 0.2s, display 0.2s allow-discrete, overlay 0.2s allow-discrete;
}

/* Position fallbacks for when tooltip doesn't fit in viewport */
/* Using @supports for progressive enhancement - works in browsers with anchor positioning support */
@supports (anchor-name: --test) {
  @position-try --tooltip-left {
    @apply mt-2 translate-x-0;
    inset: auto;
    left: anchor(left);
    top: anchor(bottom);
  }

  @position-try --tooltip-right {
    @apply mt-2 translate-x-0;
    inset: auto;
    right: anchor(right);
    top: anchor(bottom);
  }

  @position-try --tooltip-above {
    @apply mt-0 mb-2 -translate-x-1/2;
    inset: auto;
    left: anchor(center);
    bottom: anchor(top);
  }
}

/* Fallback positioning for browsers without anchor positioning support */
@supports not (anchor-name: --test) {
  .music-tooltip {
    left: 50% !important;
    top: 100% !important;
    transform: translateX(-50%);
  }
}

/* Popover animations */
.music-tooltip:popover-open {
  @apply opacity-100 translate-y-0;

  @starting-style {
    @apply opacity-0 -translate-y-2.5;
  }
}

/* Keep scrollbar styling as vendor-specific CSS */
.music-tooltip::-webkit-scrollbar {
  @apply w-1.5;
}

.music-tooltip::-webkit-scrollbar-track {
  @apply rounded;
  background: rgba(100, 100, 255, 0.1);
}

.music-tooltip::-webkit-scrollbar-thumb {
  @apply rounded;
  background: #ff0096;
}

.music-tooltip::-webkit-scrollbar-thumb:hover {
  background: #ff0096;
  box-shadow: 0 0 10px rgba(255, 0, 150, 0.8);
}

.music-tooltip-title {
  @apply break-words font-bold;
  color: #ff0096;
  font-size: var(--font-size-md);
  margin-bottom: var(--spacing-sm);
}

.music-tooltip-info {
  @apply flex flex-col;
  gap: var(--spacing-xs);
}

.music-tooltip-row {
  @apply flex;
  gap: var(--spacing-xs);
}

.music-tooltip-label {
  @apply font-bold min-w-[80px];
  color: #6464ff;
}

.music-tooltip-value {
  @apply flex-1 break-words;
  color: #00ffc8;
}

.music-player {
  @apply flex items-center;
  gap: var(--spacing-md);
}

.music-btn {
  @apply flex items-center justify-center flex-shrink-0 cursor-pointer;
  @apply w-10 h-10 rounded-full border-2 border-solid transition-all duration-300;
  background: rgba(255, 0, 150, 0.1);
  border-color: #ff0096;
  box-shadow: 0 0 15px rgba(255, 0, 150, 0.3);
  color: #ff0096;
}

.music-btn:hover {
  @apply scale-105;
  background: rgba(255, 0, 150, 0.2);
  box-shadow: 0 0 25px rgba(255, 0, 150, 0.5);
}

.music-btn:active {
  @apply scale-95;
}

.music-btn svg {
  @apply pointer-events-none;
}

.music-btn .play-icon,
.music-btn .pause-icon {
  @apply absolute;
}

.music-btn .hidden {
  @apply !hidden;
}

.music-progress {
  @apply flex flex-1 items-center;
  gap: var(--spacing-sm);
}

.music-time {
  @apply text-center min-w-[35px] font-semibold;
  color: #6464ff;
  font-family: var(--font-family-display);
  font-size: var(--font-size-xxs);
}

.progress-bar-container {
  @apply flex-1 relative cursor-pointer select-none;
  /* Increased height for better touch target */
  height: 8px;
  /* Add padding for larger touch area */
  padding: 12px 0;
  /* Transition for active state */
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-bar-bg {
  @apply absolute w-full rounded-full;
  /* Centered within the touch area */
  top: 50%;
  transform: translateY(-50%);
  height: 8px;
  background: rgba(100, 100, 255, 0.15);
  /* Smooth shadow for depth */
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
}

.progress-bar-fill {
  @apply absolute rounded-full w-0;
  top: 50%;
  transform: translateY(-50%);
  height: 8px;
  background: linear-gradient(90deg, #ff0096, #6464ff);
  box-shadow: 0 0 12px rgba(255, 0, 150, 0.6), 0 2px 8px rgba(100, 100, 255, 0.3);
  /* Smooth width transitions only, not when dragging */
  transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  /* Prevent transition during drag */
  will-change: width;
}

.progress-bar-fill.no-transition {
  transition: none;
}

.progress-bar-handle {
  @apply absolute rounded-full pointer-events-none;
  top: 50%;
  left: 0%;
  width: 16px;
  height: 16px;
  margin-left: -8px;
  margin-top: -8px;
  background: #ff0096;
  border: 2px solid white;
  box-shadow: 0 0 8px rgba(255, 0, 150, 0.6), 0 2px 4px rgba(0, 0, 0, 0.3);
  opacity: 0;
  transition: opacity 0.15s ease, box-shadow 0.15s ease, width 0.15s ease, height 0.15s ease, margin 0.15s ease;
  z-index: 10;
}

/* Desktop hover state */
@media (hover: hover) and (pointer: fine) {
  .progress-bar-container:hover .progress-bar-handle {
    opacity: 1;
  }

  .progress-bar-container:hover .progress-bar-bg {
    background: rgba(100, 100, 255, 0.25);
  }
}

/* Touch devices - always show handle */
@media (hover: none) and (pointer: coarse) {
  .progress-bar-container {
    /* Larger touch target on mobile */
    padding: 16px 0;
    height: 10px;
  }

  .progress-bar-bg,
  .progress-bar-fill {
    height: 10px;
  }

  .progress-bar-handle {
    /* Always visible and larger on mobile */
    opacity: 1;
    width: 20px;
    height: 20px;
    margin-left: -10px;
    margin-top: -10px;
  }
}

/* Active/dragging state */
.progress-bar-container.dragging .progress-bar-handle {
  opacity: 1;
  width: 20px;
  height: 20px;
  margin-left: -10px;
  margin-top: -10px;
  box-shadow: 0 0 16px rgba(255, 0, 150, 1), 0 3px 8px rgba(0, 0, 0, 0.4);
}

.progress-bar-container.dragging .progress-bar-fill {
  box-shadow: 0 0 16px rgba(255, 0, 150, 0.8), 0 3px 8px rgba(100, 100, 255, 0.4);
}

.progress-bar-container.dragging .progress-bar-bg {
  background: rgba(100, 100, 255, 0.3);
}

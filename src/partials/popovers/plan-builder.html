<!-- Plan Builder Popover - Clean 2-Step Workflow -->
<div class="plan-builder-popover" id="planBuilderPopover" popover>
  <!-- Header -->
  <div class="plan-builder-header">
    <h2 id="planBuilderTitle">Create Custom Plan</h2>
    <button aria-label="Close" class="plan-builder-close" popovertarget="planBuilderPopover" popovertargetaction="hide">
      <img alt="Close" class="svg-icon" src="/svg-icons/add-remove-delete/cancel-01.svg"/>
    </button>
  </div>

  <!-- Step 1: Build Segments -->
  <div class="plan-builder-step" id="stepSegments">
    <!-- Header -->
    <div class="step-header">
      <h3>Build Your Workout</h3>
      <p>Add segments to create your custom workout plan</p>
    </div>

    <!-- Body -->
    <div class="step-body">
      <!-- Add Segment Section (relative container for dropdown) -->
      <div class="add-segment-section">
        <!-- Add Segment Button -->
        <button class="add-segment-btn" id="addSegmentBtn" type="button">
          <img alt="Add" class="svg-icon" src="/svg-icons/add-remove-delete/remove-01.svg"/>
          <span>Add Segment</span>
        </button>

        <!-- Segment Form (dropdown below button) -->
        <div class="segment-form" hidden id="segmentForm">
          <div class="form-row">
            <div class="form-field">
              <label for="segmentTypeSelect">Type</label>
              <select id="segmentTypeSelect">
                <option value="">Choose...</option>
                <option value="prepare">Prepare</option>
                <option value="warmup">Warm-up</option>
                <option value="work">Work</option>
                <option value="rest">Rest</option>
                <option value="cooldown">Cool-down</option>
              </select>
            </div>
            <div class="form-field">
              <label for="segmentDuration">Duration (sec)</label>
              <input id="segmentDuration" max="3600" min="1" placeholder="30" type="number"/>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn-secondary" id="cancelSegmentBtn" type="button">Cancel</button>
            <button class="btn-primary" disabled id="confirmSegmentBtn" type="button">Add</button>
          </div>
        </div>
      </div>

      <!-- Segments List -->
      <div class="segments-section">
        <div class="segments-header">
          <span class="segments-title">Segments</span>
          <span class="segments-count" id="segmentCount">0</span>
        </div>
        <div class="segments-list" id="segmentsList">
          <div class="segments-empty" id="segmentsEmpty">
            <img alt="Timer" class="svg-icon" src="/svg-icons/date-and-time/timer-01.svg"/>
            <p>No segments yet</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="step-footer">
      <div class="total-duration">
        <img alt="Clock" class="svg-icon" src="/svg-icons/date-and-time/clock-01.svg"/>
        <span>Total:</span>
        <strong id="totalDuration">0:00</strong>
      </div>
      <div class="step-actions">
        <button class="btn-cancel" id="cancelStep1Btn" popovertarget="planBuilderPopover" popovertargetaction="hide"
                type="button">Cancel
        </button>
        <button class="btn-next" disabled id="nextToStep2Btn" type="button">
          <span>Next</span>
          <img alt="Next" class="svg-icon" src="/svg-icons/arrows-round/arrow-right-01-round.svg"/>
        </button>
      </div>
    </div>
  </div>

  <!-- Step 2: Plan Details -->
  <div class="plan-builder-step" hidden id="stepDetails">
    <!-- Header -->
    <div class="step-header">
      <h3>Plan Details</h3>
      <p>Name your plan and configure settings</p>
    </div>

    <!-- Body -->
    <div class="step-body">
      <div class="form-field">
        <label for="planName">Plan Name <span class="required">*</span></label>
        <input id="planName" maxlength="100" placeholder="e.g., Morning HIIT" required type="text"/>
        <span class="error-message" id="nameError"></span>
      </div>

      <div class="form-field">
        <label for="planDescription">Description</label>
        <textarea id="planDescription" maxlength="500" placeholder="Describe your workout..." rows="3"></textarea>
      </div>
    </div>

    <!-- Footer -->
    <div class="step-footer">
      <div class="step-actions">
        <button class="btn-back" id="backToStep1Btn" type="button">
          <img alt="Back" class="svg-icon" src="/svg-icons/arrows-round/arrow-right-01-round.svg"
               style="transform: rotate(180deg)"/>
          <span>Back</span>
        </button>
        <button class="btn-save" id="savePlanBtn" type="button">
          <img alt="Save" class="svg-icon" src="/svg-icons/check-validation/checkmark-circle-01.svg"/>
          <span>Save Plan</span>
        </button>
      </div>
    </div>
  </div>
</div>
